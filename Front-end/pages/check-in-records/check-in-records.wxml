<!--pages/check-in-records/check-in-records.wxml-->
<view class="records-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header-section">
    <view class="activity-info">
      <image class="activity-cover" src="{{activity.coverUrl || defaultCover}}" mode="aspectFill"></image>
      <view class="activity-meta">
        <view class="activity-title">{{activity.title}}</view>
        <view class="activity-book">ã€Š{{activity.book.title}}ã€‹</view>
      </view>
    </view>
  </view>

  <!-- æ‰“å¡è®°å½•ç»Ÿè®¡ -->
  <view class="stats-section">
    <view class="stat-item">
      <view class="stat-value">{{totalRecords}}</view>
      <view class="stat-label">æ€»æ‰“å¡</view>
    </view>
    <view class="stat-item">
      <view class="stat-value">{{myRecords}}</view>
      <view class="stat-label">æˆ‘çš„æ‰“å¡</view>
    </view>
    <view class="stat-item">
      <view class="stat-value">{{participantCount}}</view>
      <view class="stat-label">å‚ä¸äººæ•°</view>
    </view>
  </view>

  <!-- åˆ‡æ¢ç­›é€‰ -->
  <view class="filter-tabs">
    <view 
      class="tab-item {{currentTab === 'all' ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-tab="all"
    >å…¨éƒ¨æ‰“å¡</view>
    <view 
      class="tab-item {{currentTab === 'my' ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-tab="my"
    >æˆ‘çš„æ‰“å¡</view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading"></view>
  </view>

  <!-- æ‰“å¡è®°å½•åˆ—è¡¨ -->
  <view class="records-list" wx:if="{{filteredRecords.length > 0}}">
    <view class="record-item" wx:for="{{filteredRecords}}" wx:key="id">
      <view class="record-header">
        <view class="user-info">
          <image class="user-avatar" src="{{item.user.avatarUrl || '/static/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view>
            <view class="user-name">{{item.user.nickname}}</view>
            <view class="record-time">{{item.createTime}}</view>
          </view>
        </view>
        <view class="day-badge">ç¬¬{{getDayNumber(item.createTime)}}å¤©</view>
      </view>
      
      <view class="record-content" wx:if="{{item.content}}">{{item.content}}</view>
      
      <view class="image-gallery" wx:if="{{item.images && item.images.length > 0}}">
        <view class="gallery-grid" style="grid-template-columns: repeat({{item.images.length >= 3 ? 3 : item.images.length}}, 1fr);">
          <image 
            wx:for="{{item.images}}" 
            wx:for-item="img" 
            wx:for-index="imgIndex" 
            wx:key="imgIndex"
            src="{{img}}" 
            mode="aspectFill" 
            class="gallery-image"
            data-src="{{img}}"
            data-urls="{{item.images}}"
            bindtap="previewImage"
          ></image>
        </view>
      </view>
      
      <view class="audio-player" wx:if="{{item.audioPath}}">
        <view class="audio-play {{item.isPlaying ? 'playing' : ''}}" bindtap="playAudio" data-audio-path="{{item.audioPath}}" data-index="{{index}}">
          <view class="audio-icon">{{item.isPlaying ? 'âšâš' : 'â–¶'}}</view>
          <view class="audio-bars" wx:if="{{item.isPlaying}}">
            <view class="bar"></view>
            <view class="bar"></view>
            <view class="bar"></view>
          </view>
          <view class="audio-desc" wx:else>è¯­éŸ³å†…å®¹</view>
        </view>
      </view>
      
      <view class="video-container" wx:if="{{item.videoPath}}">
        <video class="record-video" src="{{item.videoPath}}"></video>
      </view>
      
      <view class="record-footer">
        <view class="record-action like {{item.isLiked ? 'liked' : ''}}" bindtap="likeRecord" data-id="{{item.id}}">
          <text class="action-icon">ğŸ‘</text>
          <text class="action-count">{{item.likes || 0}}</text>
        </view>
        <view class="record-action comment" bindtap="showComments" data-id="{{item.id}}">
          <text class="action-icon">ğŸ’¬</text>
          <text class="action-count">{{item.comments.length || 0}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ— è®°å½•æç¤º -->
  <view class="empty-records" wx:if="{{!loading && filteredRecords.length === 0}}">
    <image src="/static/images/empty-box.png" mode="aspectFit"></image>
    <text>{{currentTab === 'all' ? 'æš‚æ— æ‰“å¡è®°å½•' : 'æ‚¨è¿˜æ²¡æœ‰æ‰“å¡'}}</text>
    <block wx:if="{{currentTab === 'my' && activity.hasJoined}}">
      <button class="checkin-btn" bindtap="goToCheckIn">ç«‹å³æ‰“å¡</button>
    </block>
  </view>

  <!-- åº•éƒ¨åŒºåŸŸ -->
  <view class="bottom-area" wx:if="{{activity.hasJoined && filteredRecords.length > 0}}">
    <button class="checkin-btn" bindtap="goToCheckIn">æ‰“å¡</button>
  </view>
</view> 